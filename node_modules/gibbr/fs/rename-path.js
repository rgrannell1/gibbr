
"use strict"




var is         = require('is')
var fs         = require('fs')
var path       = require('path')
var randomName = require('gibbr/fs/random-name')





var renamePath = (fpath, shouldNuke, size) => {

	renamePath.precond(fpath, shouldNuke, size)

	fs.lstat(fpath, (err, stats) => {

		var resolvedPath = path.resolve(fpath)

		if (err) {

			process.stderr.write(err.message + '\n')
			return

		}

		if (resolvedPath === '/' && !shouldNuke) {

			process.stderr.write('attempted to rename "/" without "--no-preserve-root" option.\n')
			process.exit(1)

		}

		var renamed = stats.isDirectory( )
			? randomName.directory(fpath, size)
			: randomName.file     (fpath, size)

		fs.rename(fpath, renamed, err => {

			if (err) {
				process.stderr.write(err.message + '\n')
			}

		})

	})


}

renamePath.precond = (path, shouldNuke, size) => {

	is.always.string(path)
	is.always.boolean(shouldNuke)
	is.always.number(size)

}





module.exports = renamePath
